# ============================================
# REQ-2: 用户认证与个人中心
# 负责人: [待填写]
# 关联前端: 
#   - frontend/src/views/auth/LoginPage.vue (登录页)
#   - frontend/src/views/auth/RegisterPage.vue (注册页)
#   - frontend/src/views/auth/ForgotPasswordPage.vue (找回密码)
#   - frontend/src/views/auth/VerifyCodePage.vue (验证码验证)
#   - frontend/src/views/auth/NewPasswordPage.vue (重置密码)
#   - frontend/src/views/auth/DonePage.vue (操作完成)
#   - frontend/src/views/user/ProfilePage.vue (个人中心)
#   - frontend/src/components/Header12306.vue (顶部导航)
#   - frontend/src/components/LoginFooter.vue (底部版权)
#   - frontend/src/api/auth.js (认证接口封装)
#   - frontend/src/stores/user.js (用户状态管理)
# 关联后端: 
#   - backend/app/api/v1/endpoints/auth.py (认证核心逻辑)
#   - backend/app/api/v1/endpoints/users.py (用户信息管理)
#   - backend/app/api/v1/endpoints/password_recovery.py (密码找回流程)
#   - backend/app/models/user.py (用户数据模型)
#   - backend/app/schemas/user.py (用户数据验证)
#   - backend/app/schemas/password_recovery.py (找回密码数据验证)
#   - backend/app/core/security.py (JWT与加密工具)
#   - backend/app/core/validators.py (输入校验)
# ============================================

id: REQ-2
name: 用户认证与个人中心
functional_description: |
  包含用户注册、登录、退出、找回密码以及个人信息查看与修改功能。
  支持用户名/手机号/邮箱登录，支持短信验证码验证。
  个人中心支持查看基本信息、编辑联系方式和修改优惠类型。
ui_description: |
    整体风格简洁明快，采用12306经典蓝白色调。
    登录页包含全屏轮播背景图。
    注册页采用卡片式布局，带步骤引导和实时校验反馈。
    个人中心采用左侧菜单右侧内容的布局。
    注册页面和个人中心页面需要添加顶部Logo栏和底部版权信息。
scenarios: []

children:
  # ------------------------------------------
  # REQ-2-1: 用户登录
  # ------------------------------------------
  - id: REQ-2-1
    name: 用户登录
    functional_description: |
      用户通过账号密码或扫码方式登录系统。
      支持用户名、邮箱、手机号作为登录账号。
      连续登录失败3次或特定错误码触发图形验证码。
      支持短信验证码二次验证（可选流程）。
    ui_description: |
      参考图片路径: requirements/assets/2.用户认证与个人中心/2.1.png
      页面包含顶部Logo栏、中部全屏轮播背景、右侧悬浮登录卡片、底部版权信息。
      登录卡片包含“账号登录”和“扫码登录”两个Tab页签。
    scenarios:
      - name: 正常账号登录
        steps:
          - 用户输入用户名/邮箱/手机号
          - 用户输入密码
          - 点击“登录”按钮
          - 系统验证通过，跳转至首页或来源页
      - name: 登录失败-触发验证码
        steps:
          - 用户输入错误密码超过3次
          - 系统显示图形验证码输入框
          - 用户需输入正确的验证码才能继续尝试登录
      - name: 扫码登录（UI展示）
        steps:
          - 用户切换至“扫码登录”Tab
          - 显示二维码（模拟加载动画和过期倒计时）
          - 提示“请使用12306手机客户端扫码登录”
    children:
      - id: REQ-2-1-1
        name: 登录表单
        functional_description: |
          包含用户名、密码输入框，以及“登录”按钮。
          输入框带图标前缀。
          密码输入框不支持明文显示切换。
          包含“注册12306账号”和“忘记密码”链接。
        ui_description: |
          参考图片路径: requirements/assets/2.用户认证与个人中心/2.1.1_login_form.png
          使用 Ant Design Vue 表单组件。
          用户名输入框 placeholder: "用户名/邮箱/手机号"。
          密码输入框 placeholder: "密码"。
        scenarios:
          - name: 字段为空校验
            steps:
              - action: 未输入任何内容，直接点击“登录”按钮
              - expectation: 用户名输入框下显示红色错误提示“请输入用户名/邮箱/手机号”，密码框显示“请输入密码”。
          - name: 输入格式错误
            steps:
              - action: 输入无效的用户名（如特殊字符）或过短的密码
              - expectation: 失去焦点或点击登录时，显示相应的格式错误提示。
          - name: 提交登录请求
            steps:
              - action: 输入有效的用户名和密码，点击“登录”按钮
              - expectation: 按钮进入 loading 状态，若需验证码则弹出验证码窗口，否则直接调用登录接口。

      - id: REQ-2-1-2
        name: 短信验证码弹窗
        functional_description: |
          弹窗要求输入证件号后4位和短信验证码。
          提供“获取验证码”按钮，带60秒倒计时。
        ui_description: |
          参考图片路径: requirements/assets/2.用户认证与个人中心/2.1.2_sms_modal.png
          Modal 弹窗，标题“选择验证方式”，子标题“短信验证”。
        scenarios:
          - name: 获取短信验证码
            steps:
              - action: 输入证件号后4位，点击“获取验证码”
              - expectation: 后端验证通过后发送验证码，按钮进入60秒倒计时状态。
          - name: 确认验证
            steps:
              - action: 输入收到的6位验证码，点击“确定”
              - expectation: 系统提交登录请求（含用户名、密码、证件号后4位、短信验证码），验证通过后跳转。

  # ------------------------------------------
  # REQ-2-2: 用户注册
  # ------------------------------------------
  - id: REQ-2-2
    name: 用户注册
    functional_description: |
      新用户填写详细信息注册账号。
      注册成功后自动分配“user”角色，并创建默认乘车人记录。
    ui_description: |
      参考图片路径: requirements/assets/2.用户认证与个人中心/2.2_register_page.png
      页面包含顶部蓝色导航条、Logo栏、面包屑导航、主体注册卡片。
      注册卡片标题栏为深蓝色背景，白色文字。
    scenarios:
      - name: 正常注册流程
        steps:
          - 用户填写所有必填字段
          - 勾选“我已阅读并同意《用户服务条款》和《隐私政策》”
          - 点击“下一步”
          - 系统校验通过，提示注册成功并跳转登录页
      - name: 字段校验失败
        steps:
          - 用户名已存在/格式错误 -> 显示红色错误提示
          - 密码强度不足 -> 实时强度条显示“弱”
          - 两次密码不一致 -> 失去焦点时提示错误
    children:
      - id: REQ-2-2-1
        name: 账户信息输入
        functional_description: |
          - **用户名**: 必填，6-30位字母、数字或“_”，字母开头。不可修改。
          - **密码**: 必填，6-20位，必须包含字母和数字。
          - **确认密码**: 必须与密码一致。
          - **密码强度条**: 根据输入实时计算（弱/中/强/很强），四色进度条展示。
        ui_description: |
          参考图片路径: requirements/assets/2.用户认证与个人中心/2.2.1_account_info.png
          密码强度条位于密码框下方。
        scenarios:
          - name: 密码强度校验
            steps:
              - action: 输入纯数字或纯字母密码
              - expectation: 提示“密码必须包含字母和数字”，强度条显示低等级。
          - name: 密码一致性校验
            steps:
              - action: 确认密码与密码不一致，输入框失去焦点
              - expectation: 显示错误提示“两次输入密码不一致”。

      - id: REQ-2-2-2
        name: 个人信息输入
        functional_description: |
          - **证件类型**: 下拉选择（居民身份证、港澳居民居住证、台湾居民居住证、护照等）。
          - **姓名**: 必填，2-20位中文。
          - **证件号码**: 必填，根据证件类型正则校验（身份证18位）。
          - **优惠(待)类型**: 下拉选择（成人、儿童、学生、残疾军人）。
        ui_description: |
          参考图片路径: requirements/assets/2.用户认证与个人中心/2.2.2_personal_info.png
          表单采用水平布局，Label右对齐。
        scenarios:
          - name: 身份证格式校验
            steps:
              - action: 选择“居民身份证”，输入错误的号码（如长度不对或校验位错误）
              - expectation: 显示错误提示“请输入正确的身份证号码”。

      - id: REQ-2-2-3
        name: 联系方式输入
        functional_description: |
          - **邮箱**: 必填，Email格式校验。
          - **手机号**: 必填，支持区号选择（+86, +852, +853, +886），默认+86。
        ui_description: |
          参考图片路径: requirements/assets/2.用户认证与个人中心/2.2.3_contact_info.png
          手机号输入框为组合型，左侧选择区号，右侧输入号码。
        scenarios:
          - name: 手机号格式校验
            steps:
              - action: 输入非 1 开头的手机号或长度不足
              - expectation: 显示错误提示“请输入正确的手机号”。

  # ------------------------------------------
  # REQ-2-3: 找回密码
  # ------------------------------------------
  - id: REQ-2-3
    name: 找回密码
    functional_description: |
      通过验证身份信息重置密码。
      目前实现为模拟发送重置链接。
    ui_description: |
      参考图片路径: requirements/assets/2.用户认证与个人中心/2.3_forgot_password.png
      通常为模态框或独立页面。
    scenarios:
      - name: 鼠标悬停
        steps:
          - action: 鼠标移动到 Header 上的“我的12306”
          - expectation: 自动展开下拉菜单，显示“火车票订单”、“个人中心”等选项。
      - name: 状态切换
        steps:
          - action: 用户登录成功后重定向回首页
          - expectation: Header 右侧由“登录/注册”变为显示用户名。

  # ------------------------------------------
  # REQ-2-4: 个人信息管理
  # ------------------------------------------
  - id: REQ-2-4
    name: 个人信息管理
    functional_description: |
      用户登录后查看和修改个人资料。
      分为“基本信息”、“联系方式”、“附加信息”三个模块。
      支持查看模式和编辑模式切换。
    ui_description: |
      参考图片路径: requirements/assets/2.用户认证与个人中心/2.4_profile_page.png
      左侧菜单，右侧内容区。
      内容区包含欢迎页（默认）和信息详情页。
    scenarios:
      - name: 查看欢迎页
        steps:
          - 登录后进入个人中心
          - 显示欢迎语（根据时间段变化：上午好/下午好等）
          - 显示安全提示和二维码
      - name: 修改联系方式
        steps:
          - 点击“联系方式”栏的“编辑”按钮
          - 输入新的手机号或邮箱
          - 点击“保存”
          - 系统提示保存成功，状态切换回查看模式
    children:
      - id: REQ-2-4-1
        name: 基本信息模块
        functional_description: |
          **展示**: 用户名、姓名、国家/地区（固定中国）、证件类型、证件号码（脱敏显示）、核验状态。
          **编辑**: 仅允许修改“姓名”（real_name）。用户名、证件信息不可修改。
        ui_description: |
          参考图片路径: requirements/assets/2.用户认证与个人中心/2.4.1_basic_info.png
          字段前带红色星号表示必填。
          编辑模式下，不可改字段显示为纯文本，可改字段显示为输入框。
        scenarios: []

      - id: REQ-2-4-2
        name: 联系方式模块
        functional_description: |
          **展示**: 手机号（脱敏）、邮箱。显示“已通过核验”状态。
          **编辑**: 允许修改手机号和邮箱。修改手机号会有提示“(修改后需重新核验)”。
        ui_description: |
          参考图片路径: requirements/assets/2.用户认证与个人中心/2.4.2_contact_info.png
          使用虚线分隔不同模块。
        scenarios: []

      - id: REQ-2-4-3
        name: 附加信息模块
        functional_description: |
          **展示**: 优惠(待)类型。
          **编辑**: 下拉选择（成人/儿童/学生/残疾军人）。
        ui_description: |
          参考图片路径: requirements/assets/2.用户认证与个人中心/2.4.3_additional_info.png
          编辑状态下显示下拉菜单。
          保存时将数字值映射回后端枚举类型。
        scenarios:
          - name: 修改优惠类型
            steps:
              - action: 点击“编辑”，从下拉菜单选择新的类型（如“学生”）
              - expectation: 点击保存后，后端枚举值更新，界面显示新的类型名称。

  # ------------------------------------------
  # REQ-2-5: 退出登录
  # ------------------------------------------
  - id: REQ-2-5
    name: 退出登录
    functional_description: |
      清除本地 Token 和用户状态。
      调用后端 Logout 接口（可选，因JWT无状态）。
      跳转回首页或登录页。
      用户点击导航栏下拉菜单中的“退出登录”按钮触发。
    scenarios: []

  # ------------------------------------------
  # REQ-2-6: 导航栏用户状态
  # ------------------------------------------
  - id: REQ-2-6
    name: 导航栏用户状态
    functional_description: |
      全局 Header 组件根据 `userStore.isAuthenticated` 状态切换显示。
    ui_description: |
      参考图片路径: requirements/assets/2.用户认证与个人中心/2.6.png
    scenarios:
      - name: 鼠标悬停
        steps:
          - action: 鼠标移动到 Header 上的“我的12306”
          - expectation: 自动展开下拉菜单，显示“火车票订单”、“个人中心”等选项。
      - name: 状态切换
        steps:
          - action: 用户登录成功后重定向回首页
          - expectation: Header 右侧由“登录/注册”变为显示用户名。
    children:
      - id: REQ-2-6-1
        name: 未登录状态
        functional_description: "显示“登录”和“注册”链接。"
        ui_description: |
          参考图片路径: requirements/assets/2.用户认证与个人中心/2.6.1_header_unauth.png
          位于 Header 右侧。
        scenarios: []

      - id: REQ-2-6-2
        name: 已登录状态
        functional_description: |
          显示“欢迎您，[用户名]” 或 “[姓名]”。
          提供“我的12306”下拉菜单，包含“火车票订单”、“本人车票”、“我的餐饮”、“我的保险”、“个人中心”、“账户安全”、“退出登录”等选项。
        ui_description: |
          参考图片路径: requirements/assets/2.用户认证与个人中心/2.6.2_header_auth.png
          鼠标悬停显示下拉菜单。
        scenarios: []

api_endpoints:
  - method: POST
    path: /auth/login
    description: 用户登录，返回 Access Token
  - method: POST
    path: /auth/register
    description: 用户注册
  - method: POST
    path: /auth/login/verify-code
    description: 发送登录验证码
  - method: GET
    path: /users/profile
    description: 获取当前用户信息
  - method: PUT
    path: /users/profile
    description: 更新当前用户信息

data_structure:
  User:
    description: 用户实体
    fields:
      - name: username
        type: string
        description: 登录名，唯一
      - name: password
        type: string
        description: 加密后的密码
      - name: real_name
        type: string
        description: 真实姓名
      - name: id_type
        type: string
        description: 证件类型枚举
      - name: id_number
        type: string
        description: 证件号码，唯一
      - name: phone
        type: string
        description: 手机号
      - name: email
        type: string
        description: 邮箱
      - name: user_type
        type: string
        description: 用户类型（成人/儿童/学生/残疾军人）
