# 铁路12306项目需求文档

## 项目概述
这是一个模仿铁路12306官方网站的课程项目，需要实现火车票查询、预订等核心功能。

**参考网站**：https://www.12306.cn/  
**文档版本**：v1.0  
**创建日期**：2025-10-13

---

## 一、项目范围说明

### 1.1 实现要求
- 围绕给定的界面和功能模块，尽可能还原12306核心功能
- 支付功能简化为"一键支付"弹窗
- 后台数据（车票信息）可程序随机生成或使用AI生成
- 未提及的界面和功能可从简或不考虑
- **仅考虑单程、普通票**

### 1.2 核心业务模块
1. 用户认证（登录/注册）
2. 车票查询与筛选
3. 订单管理
4. 乘客管理
5. 个人信息管理

---

## 二、界面需求

### 2.1 首页/查询页

#### 2.1.1 顶部导航栏
**必需组件**：
- Logo（中国铁路12306）
- 登录/注册入口
- 个人中心入口（登录后显示用户名）

#### 2.1.2 车票查询表单
**输入组件**：
- 出发地输入框
  - 支持城市/车站名称输入
  - 可下拉选择
  
- 目的地输入框
  - 支持城市/车站名称输入
  - 可下拉选择
  
- 出发日期选择器
  - 日期选择控件
  - 默认今天
  - 可选择未来30天内日期

- 查询按钮
  - 点击跳转至车次列表页

#### 2.1.3 常用功能快捷入口
- 个人中心入口
- 车票查询页入口
- 订单查询入口

---

### 2.2 登录/注册页

#### 2.2.1 登录页面
**核心组件**：
- 用户名/手机号输入框
- 密码输入框
- 验证码输入框（图形验证码）
- 登录按钮
- 注册入口链接

**登录逻辑**：
- 验证用户名/手机号和密码
- 验证码校验
- 登录成功后跳转至首页或原页面
- 登录失败显示错误提示

#### 2.2.2 注册页面
**必填字段**：

1. **用户类型选择**
   - 成人
   - 学生

2. **登录名设置**
   - 6-30位字符
   - 仅支持数字或英文字母
   - 唯一性校验

3. **邮箱**
   - 邮箱格式验证
   - 用于账号找回

4. **真实姓名**
   - 中文姓名

5. **证件类型选择**
   - 居民身份证
   - 护照
   - 其他证件类型

6. **证件号码**
   - 根据证件类型验证格式
   - 身份证号码格式验证（18位）

7. **手机号**
   - 11位手机号
   - 格式验证

8. **密码设置**
   - 6-20位
   - 需包含字母和数字
   - 二次确认密码

**表单验证**：
- 实时验证各字段格式
- 提交时统一验证
- 显示具体错误信息

---

### 2.3 车次列表页

#### 2.3.1 查询条件展示区
**显示内容**：
- 出发地
- 目的地
- 出发日期
- 修改查询按钮（可重新查询）

#### 2.3.2 筛选条件区
**筛选选项**：

1. **车次类型**
   - 高铁（G字头）
   - 动车（D字头）
   - 直达（Z字头）
   - 全部

2. **出发车站筛选**
   - 当有多个出发站时显示
   - 复选框形式

3. **到达车站筛选**
   - 当有多个到达站时显示
   - 复选框形式

4. **席别筛选**
   - 一等座
   - 二等座
   - 软卧
   - 硬卧
   - 有票/无票

5. **出发时间段筛选**
   - 00:00-06:00（凌晨）
   - 06:00-12:00（上午）
   - 12:00-18:00（下午）
   - 18:00-24:00（晚上）

#### 2.3.3 车次列表
**列表信息（每条记录）**：
- 车次号（如 G1234）
- 出发站 → 到达站
- 出发时间 - 到达时间
- 历时（如 5小时23分）
- 一等座余票数 + 票价
- 二等座余票数 + 票价
- 软卧余票数 + 票价
- 硬卧余票数 + 票价
- 预订按钮

**排序功能**：
- 按出发时间排序（默认）
- 按历时排序
- 按票价排序

**列表交互**：
- 点击预订按钮进入订单填写页
- 如果该席别无票则按钮置灰不可点击

---

### 2.4 订单填写页

#### 2.4.1 列车信息展示
**显示内容**：
- 车次号
- 出发站 → 到达站
- 出发日期
- 出发时间 - 到达时间
- 历时
- 选择的席别类型

#### 2.4.2 乘客信息选择
**功能要求**：
- 显示当前用户关联的所有乘客
- 可多选乘客（同时为多人购票）
- 每位乘客需选择：
  - 票种（成人票/学生票/儿童票）
  - 席别（如果有多种可选）

**乘客信息显示**：
- 姓名
- 证件类型
- 证件号码
- 手机号

**添加乘客入口**：
- 如果没有乘客，提示添加
- 提供快速添加乘客入口

#### 2.4.3 订单信息汇总
**显示内容**：
- 乘客数量
- 各席别数量和单价
- 订单总价

#### 2.4.4 提交订单
**操作按钮**：
- 提交订单按钮
- 点击后创建订单
- 跳转至订单详情页（待支付状态）

---

### 2.5 个人中心

#### 2.5.1 导航菜单
**菜单项**：
- 个人信息
- 乘客管理
- 订单管理

#### 2.5.2 个人信息页
**显示/编辑内容**：
- 用户名（不可修改）
- 真实姓名
- 证件类型
- 证件号码
- 手机号
- 邮箱
- 用户类型

**操作**：
- 编辑按钮
- 保存修改按钮
- 取消按钮

#### 2.5.3 乘客管理页

**乘客列表**：
- 以卡片或表格形式展示
- 每条记录显示：
  - 姓名
  - 证件类型
  - 证件号码（部分隐藏，如：`110***********1234`）
  - 手机号
  - 验证状态（已验证/未验证）
  - 操作按钮（编辑、删除）

**添加乘客**：
- 添加乘客按钮
- 弹出表单或跳转新页面
- 必填字段：
  - 姓名
  - 证件类型
  - 证件号码
  - 手机号
  - 旅客类型（成人/学生/儿童）

**编辑乘客**：
- 点击编辑按钮
- 弹出表单或跳转编辑页
- 可修改所有信息
- 保存修改

**删除乘客**：
- 点击删除按钮
- 二次确认弹窗
- 确认后删除

**验证规则**：
- 姓名：2-10个中文字符
- 手机号：11位数字
- 证件号码根据类型验证

#### 2.5.4 订单管理页

**订单列表筛选**：
- 未出行订单（默认）
- 历史订单
- 全部订单

**订单列表显示**：
每条订单卡片包含：
- 订单号
- 订单状态（待支付/已支付/已取消/已退票/已完成）
- 车次信息（车次号、出发站、到达站、日期时间）
- 乘客信息（姓名、席别、票价）
- 总价
- 下单时间
- 操作按钮

**订单状态及操作**：

1. **待支付订单**
   - 显示剩余支付时间（45分钟倒计时）
   - 操作：支付、取消订单

2. **已支付订单（未出行）**
   - 操作：查看详情、退票

3. **已取消/已退票订单**
   - 显示取消/退票时间
   - 操作：查看详情

4. **已完成订单（历史订单）**
   - 已过出发时间的订单
   - 操作：查看详情

**订单详情**：
- 点击订单卡片或查看详情按钮
- 显示完整订单信息：
  - 订单编号
  - 车次详细信息
  - 所有乘客信息
  - 价格明细
  - 订单状态变更记录
  - 支付信息（如已支付）

**支付功能（简化）**：
- 点击支付按钮
- 弹出"一键支付"确认框
- 确认后订单状态变为已支付
- 提示支付成功

**退票功能**：
- 点击退票按钮
- 显示退票确认弹窗
  - 显示退票手续费说明
  - 可选择退票的乘客（部分退票）
  - 显示退款金额
- 确认后订单状态变为已退票

---

## 三、核心功能详细说明

### 3.1 登录与注册功能

#### 3.1.1 注册流程
1. 用户进入注册页面
2. 填写所有必填信息
3. 前端验证各字段格式
4. 提交注册信息
5. 后端验证：
   - 用户名唯一性
   - 邮箱唯一性
   - 手机号唯一性
   - 证件号码唯一性
6. 验证通过，创建账户
7. 自动登录，跳转首页

#### 3.1.2 登录流程
1. 输入用户名/手机号
2. 输入密码
3. 输入验证码
4. 点击登录
5. 后端验证：
   - 用户存在性
   - 密码正确性
   - 验证码正确性
6. 验证通过，创建登录会话
7. 跳转至首页或之前访问的页面

#### 3.1.3 会话管理
- 登录后保持会话状态
- 未登录用户访问需登录的页面时跳转登录页
- 登录后可跳转回原页面
- 退出登录功能

---

### 3.2 车票查询与筛选功能

#### 3.2.1 首页查询流程
1. 用户在首页输入：
   - 出发地（必填）
   - 目的地（必填）
   - 出发日期（必填，默认今天）
2. 点击查询按钮
3. 验证输入合法性
4. 携带查询参数跳转至车次列表页

#### 3.2.2 车次查询逻辑（后端）
**查询条件**：
- 出发地（城市或车站）
- 目的地（城市或车站）
- 出发日期

**查询结果**：
- 查找符合条件的所有车次
- 获取每个车次的：
  - 基本信息（车次号、出发/到达站、时间）
  - 各席别余票数
  - 各席别票价

**余票计算**：
- 余票数 = 总座位数 - 已售座位数
- 实时更新

#### 3.2.3 筛选功能
**前端筛选逻辑**：
1. 用户选择筛选条件（车次类型、席别、时间段等）
2. 前端根据筛选条件过滤车次列表
3. 动态更新显示结果

**筛选组合**：
- 支持多条件同时筛选
- 条件之间为"且"关系
- 实时响应，无需重新请求后端

#### 3.2.4 排序功能
**支持的排序方式**：
- 出发时间升序/降序
- 历时升序/降序
- 票价升序/降序

---

### 3.3 订单管理功能

#### 3.3.1 创建订单流程
1. 用户在车次列表页点击预订
2. 进入订单填写页
3. 选择乘客（必须至少选择一位）
4. 为每位乘客选择票种和席别
5. 确认订单信息
6. 点击提交订单
7. 后端创建订单：
   - 生成订单号
   - 记录车次信息
   - 记录乘客信息
   - 计算总价
   - 锁定座位（预留45分钟）
   - 订单状态设为"待支付"
8. 跳转至订单详情页

#### 3.3.2 支付订单（简化实现）
1. 用户在订单详情页或订单列表点击"支付"
2. 弹出"一键支付"确认框
3. 用户点击确认
4. 后端更新订单状态为"已支付"
5. 确认座位占用
6. 显示支付成功提示
7. 更新订单列表

#### 3.3.3 取消订单
1. 用户在待支付订单点击"取消订单"
2. 二次确认弹窗
3. 用户确认取消
4. 后端：
   - 订单状态改为"已取消"
   - 释放座位
5. 提示取消成功

#### 3.3.4 退票功能
1. 用户在已支付订单点击"退票"
2. 显示退票确认弹窗：
   - 可选择部分乘客退票
   - 显示退票手续费
   - 显示退款金额
3. 用户确认退票
4. 后端：
   - 更新订单状态（全部退票→已退票，部分退票→部分退票）
   - 释放相应座位
   - 计算退款金额
   - 记录退款信息
5. 提示退票成功

#### 3.3.5 订单超时处理
- 订单创建后45分钟内未支付自动取消
- 定时任务检查超时订单
- 自动释放座位
- 更新订单状态为"已取消"

---

### 3.4 乘客管理功能

#### 3.4.1 添加乘客
1. 用户进入乘客管理页
2. 点击"添加乘客"按钮
3. 填写乘客信息：
   - 姓名
   - 证件类型
   - 证件号码
   - 手机号
   - 旅客类型
4. 前端验证字段格式
5. 提交信息
6. 后端验证：
   - 证件号码格式
   - 手机号格式
   - 该用户下是否已存在相同证件号的乘客
7. 保存乘客信息
8. 刷新乘客列表

#### 3.4.2 编辑乘客
1. 用户点击"编辑"按钮
2. 显示编辑表单（预填充当前信息）
3. 修改信息
4. 前端验证
5. 提交修改
6. 后端验证并更新
7. 刷新乘客列表

#### 3.4.3 删除乘客
1. 用户点击"删除"按钮
2. 二次确认弹窗："确定要删除该乘客吗？"
3. 用户确认
4. 后端检查：
   - 该乘客是否有未完成的订单
   - 如有未完成订单，提示无法删除
5. 删除乘客记录
6. 刷新乘客列表

#### 3.4.4 乘客验证状态
**验证状态说明**：
- 已验证：乘客信息已通过系统验证
- 未验证：新添加的乘客，尚未验证

**验证逻辑（可选实现）**：
- 自动验证：添加乘客时后端自动验证证件号格式
- 验证通过后标记为"已验证"

---

### 3.5 个人信息管理功能

#### 3.5.1 查看个人信息
- 进入个人中心→个人信息
- 显示所有个人信息
- 敏感信息部分隐藏（如证件号中间几位）

#### 3.5.2 编辑个人信息
**可编辑字段**：
- 真实姓名
- 手机号
- 邮箱

**不可编辑字段**：
- 用户名
- 证件类型
- 证件号码
- 用户类型

**编辑流程**：
1. 点击"编辑"按钮
2. 输入框变为可编辑状态
3. 修改信息
4. 前端验证格式
5. 点击"保存"
6. 后端验证：
   - 手机号格式
   - 邮箱格式
   - 手机号/邮箱唯一性（如修改）
7. 更新信息
8. 提示保存成功

---

## 四、数据库设计

### 4.1 用户表（users）
| 字段名 | 数据类型 | 说明 | 约束 |
|--------|----------|------|------|
| id | INT | 用户ID | 主键，自增 |
| username | VARCHAR(30) | 登录名 | 唯一，非空 |
| password | VARCHAR(255) | 密码（加密） | 非空 |
| real_name | VARCHAR(50) | 真实姓名 | 非空 |
| id_type | VARCHAR(20) | 证件类型 | 非空 |
| id_number | VARCHAR(50) | 证件号码 | 唯一，非空 |
| phone | VARCHAR(11) | 手机号 | 唯一，非空 |
| email | VARCHAR(100) | 邮箱 | 唯一 |
| user_type | VARCHAR(20) | 用户类型（成人/学生） | 非空 |
| create_time | DATETIME | 创建时间 | 默认当前时间 |
| update_time | DATETIME | 更新时间 | 更新时自动修改 |

### 4.2 乘客表（passengers）
| 字段名 | 数据类型 | 说明 | 约束 |
|--------|----------|------|------|
| id | INT | 乘客ID | 主键，自增 |
| user_id | INT | 关联用户ID | 外键，非空 |
| name | VARCHAR(50) | 姓名 | 非空 |
| id_type | VARCHAR(20) | 证件类型 | 非空 |
| id_number | VARCHAR(50) | 证件号码 | 非空 |
| phone | VARCHAR(11) | 手机号 | 非空 |
| passenger_type | VARCHAR(20) | 旅客类型（成人/学生/儿童） | 非空 |
| verified | BOOLEAN | 是否已验证 | 默认false |
| create_time | DATETIME | 创建时间 | 默认当前时间 |

**索引**：
- user_id（提高查询效率）
- 复合唯一索引：(user_id, id_number)（同一用户不能添加重复证件号的乘客）

### 4.3 车站表（stations）
| 字段名 | 数据类型 | 说明 | 约束 |
|--------|----------|------|------|
| id | INT | 车站ID | 主键，自增 |
| station_name | VARCHAR(50) | 车站名称 | 唯一，非空 |
| city | VARCHAR(50) | 所属城市 | 非空 |
| pinyin | VARCHAR(50) | 拼音（用于搜索） | 非空 |
| short_pinyin | VARCHAR(10) | 简拼（用于搜索） | 非空 |

### 4.4 车次表（trains）
| 字段名 | 数据类型 | 说明 | 约束 |
|--------|----------|------|------|
| id | INT | 车次ID | 主键，自增 |
| train_number | VARCHAR(10) | 车次号（如G1234） | 唯一，非空 |
| train_type | VARCHAR(10) | 车次类型（高铁/动车/直达） | 非空 |
| departure_station_id | INT | 出发站ID | 外键，非空 |
| arrival_station_id | INT | 到达站ID | 外键，非空 |
| departure_time | TIME | 出发时间 | 非空 |
| arrival_time | TIME | 到达时间 | 非空 |
| duration_minutes | INT | 历时（分钟） | 非空 |
| first_class_seats | INT | 一等座总数 | 默认0 |
| second_class_seats | INT | 二等座总数 | 默认0 |
| soft_sleeper_seats | INT | 软卧总数 | 默认0 |
| hard_sleeper_seats | INT | 硬卧总数 | 默认0 |
| first_class_price | DECIMAL(10,2) | 一等座票价 | 默认0 |
| second_class_price | DECIMAL(10,2) | 二等座票价 | 默认0 |
| soft_sleeper_price | DECIMAL(10,2) | 软卧票价 | 默认0 |
| hard_sleeper_price | DECIMAL(10,2) | 硬卧票价 | 默认0 |

**说明**：
- 为简化设计，每个车次固定出发站和到达站
- 实际12306支持中途上下车，这里简化处理

### 4.5 座位表（seats）
| 字段名 | 数据类型 | 说明 | 约束 |
|--------|----------|------|------|
| id | INT | 座位ID | 主键，自增 |
| train_id | INT | 车次ID | 外键，非空 |
| travel_date | DATE | 乘车日期 | 非空 |
| seat_type | VARCHAR(20) | 座位类型（一等座/二等座/软卧/硬卧） | 非空 |
| seat_number | VARCHAR(10) | 座位号（如1车01A） | 非空 |
| status | VARCHAR(20) | 状态（可售/已售/已锁定） | 非空，默认"可售" |
| locked_until | DATETIME | 锁定截止时间（订单未支付时锁定） | 可空 |

**索引**：
- 复合索引：(train_id, travel_date, seat_type, status)（快速查询余票）

**说明**：
- 每天每个车次的座位独立生成
- 锁定机制：创建订单时锁定座位45分钟，超时或取消后释放

### 4.6 订单表（orders）
| 字段名 | 数据类型 | 说明 | 约束 |
|--------|----------|------|------|
| id | INT | 订单ID | 主键，自增 |
| order_number | VARCHAR(50) | 订单号（唯一标识） | 唯一，非空 |
| user_id | INT | 用户ID | 外键，非空 |
| train_id | INT | 车次ID | 外键，非空 |
| travel_date | DATE | 乘车日期 | 非空 |
| total_price | DECIMAL(10,2) | 订单总价 | 非空 |
| status | VARCHAR(20) | 订单状态 | 非空 |
| create_time | DATETIME | 创建时间 | 默认当前时间 |
| pay_time | DATETIME | 支付时间 | 可空 |
| cancel_time | DATETIME | 取消时间 | 可空 |

**订单状态枚举**：
- 待支付（PENDING）
- 已支付（PAID）
- 已取消（CANCELLED）
- 已退票（REFUNDED）
- 部分退票（PARTIAL_REFUNDED）
- 已完成（COMPLETED）

**索引**：
- user_id（查询用户订单）
- order_number（订单号查询）

### 4.7 订单乘客表（order_passengers）
| 字段名 | 数据类型 | 说明 | 约束 |
|--------|----------|------|------|
| id | INT | 记录ID | 主键，自增 |
| order_id | INT | 订单ID | 外键，非空 |
| passenger_id | INT | 乘客ID | 外键，非空 |
| seat_id | INT | 座位ID | 外键，非空 |
| ticket_type | VARCHAR(20) | 票种（成人票/学生票/儿童票） | 非空 |
| seat_type | VARCHAR(20) | 席别（一等座/二等座/软卧/硬卧） | 非空 |
| price | DECIMAL(10,2) | 票价 | 非空 |
| refund_status | VARCHAR(20) | 退票状态（未退票/已退票） | 默认"未退票" |
| refund_time | DATETIME | 退票时间 | 可空 |
| refund_amount | DECIMAL(10,2) | 退款金额 | 可空 |

**说明**：
- 一个订单可以有多个乘客
- 记录每个乘客的座位、票价等信息
- 支持部分退票

---

## 五、核心接口设计（API）

### 5.1 用户认证接口

#### 5.1.1 用户注册
- **接口**：`POST /api/auth/register`
- **请求参数**：
```json
{
  "username": "zhangsan",
  "password": "Password123",
  "realName": "张三",
  "idType": "居民身份证",
  "idNumber": "110101199001011234",
  "phone": "13800138000",
  "email": "zhangsan@example.com",
  "userType": "成人"
}
```
- **响应**：
```json
{
  "code": 200,
  "message": "注册成功",
  "data": {
    "userId": 1,
    "username": "zhangsan"
  }
}
```

#### 5.1.2 用户登录
- **接口**：`POST /api/auth/login`
- **请求参数**：
```json
{
  "username": "zhangsan",
  "password": "Password123",
  "captcha": "ABCD"
}
```
- **响应**：
```json
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "userId": 1,
    "username": "zhangsan"
  }
}
```

#### 5.1.3 退出登录
- **接口**：`POST /api/auth/logout`
- **请求头**：`Authorization: Bearer {token}`
- **响应**：
```json
{
  "code": 200,
  "message": "退出成功"
}
```

### 5.2 车票查询接口

#### 5.2.1 查询车次
- **接口**：`GET /api/trains/search`
- **请求参数**：
  - `departureCity`: 出发地
  - `arrivalCity`: 到达地
  - `travelDate`: 出发日期（YYYY-MM-DD）
- **响应**：
```json
{
  "code": 200,
  "message": "查询成功",
  "data": [
    {
      "trainId": 1,
      "trainNumber": "G1234",
      "trainType": "高铁",
      "departureStation": "北京南",
      "arrivalStation": "上海虹桥",
      "departureTime": "08:00",
      "arrivalTime": "13:30",
      "duration": "5小时30分",
      "seats": {
        "firstClass": {
          "available": 50,
          "price": 933.0
        },
        "secondClass": {
          "available": 120,
          "price": 553.0
        },
        "softSleeper": {
          "available": 0,
          "price": 0
        },
        "hardSleeper": {
          "available": 0,
          "price": 0
        }
      }
    }
  ]
}
```

### 5.3 订单接口

#### 5.3.1 创建订单
- **接口**：`POST /api/orders/create`
- **请求头**：`Authorization: Bearer {token}`
- **请求参数**：
```json
{
  "trainId": 1,
  "travelDate": "2025-10-20",
  "passengers": [
    {
      "passengerId": 1,
      "ticketType": "成人票",
      "seatType": "二等座"
    },
    {
      "passengerId": 2,
      "ticketType": "学生票",
      "seatType": "二等座"
    }
  ]
}
```
- **响应**：
```json
{
  "code": 200,
  "message": "订单创建成功",
  "data": {
    "orderId": 1,
    "orderNumber": "E202510131234567890",
    "totalPrice": 1053.0,
    "status": "待支付",
    "expireTime": "2025-10-13 15:30:00"
  }
}
```

#### 5.3.2 支付订单
- **接口**：`POST /api/orders/{orderId}/pay`
- **请求头**：`Authorization: Bearer {token}`
- **响应**：
```json
{
  "code": 200,
  "message": "支付成功",
  "data": {
    "orderId": 1,
    "orderNumber": "E202510131234567890",
    "status": "已支付"
  }
}
```

#### 5.3.3 取消订单
- **接口**：`POST /api/orders/{orderId}/cancel`
- **请求头**：`Authorization: Bearer {token}`
- **响应**：
```json
{
  "code": 200,
  "message": "订单已取消"
}
```

#### 5.3.4 退票
- **接口**：`POST /api/orders/{orderId}/refund`
- **请求头**：`Authorization: Bearer {token}`
- **请求参数**：
```json
{
  "passengerIds": [1, 2]  // 要退票的乘客ID，空数组表示全部退票
}
```
- **响应**：
```json
{
  "code": 200,
  "message": "退票成功",
  "data": {
    "refundAmount": 1053.0,
    "refundFee": 52.65
  }
}
```

#### 5.3.5 查询订单列表
- **接口**：`GET /api/orders`
- **请求头**：`Authorization: Bearer {token}`
- **请求参数**：
  - `status`: 订单状态（可选，不传则查全部）
- **响应**：
```json
{
  "code": 200,
  "message": "查询成功",
  "data": [
    {
      "orderId": 1,
      "orderNumber": "E202510131234567890",
      "trainNumber": "G1234",
      "departureStation": "北京南",
      "arrivalStation": "上海虹桥",
      "travelDate": "2025-10-20",
      "departureTime": "08:00",
      "totalPrice": 1053.0,
      "status": "已支付",
      "passengerCount": 2,
      "createTime": "2025-10-13 14:45:00"
    }
  ]
}
```

#### 5.3.6 查询订单详情
- **接口**：`GET /api/orders/{orderId}`
- **请求头**：`Authorization: Bearer {token}`
- **响应**：
```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "orderId": 1,
    "orderNumber": "E202510131234567890",
    "train": {
      "trainNumber": "G1234",
      "departureStation": "北京南",
      "arrivalStation": "上海虹桥",
      "departureTime": "08:00",
      "arrivalTime": "13:30",
      "travelDate": "2025-10-20"
    },
    "passengers": [
      {
        "name": "张三",
        "idNumber": "110101199001011234",
        "seatType": "二等座",
        "seatNumber": "3车06A",
        "ticketType": "成人票",
        "price": 553.0,
        "refundStatus": "未退票"
      },
      {
        "name": "李四",
        "idNumber": "110101200001011234",
        "seatType": "二等座",
        "seatNumber": "3车06B",
        "ticketType": "学生票",
        "price": 500.0,
        "refundStatus": "未退票"
      }
    ],
    "totalPrice": 1053.0,
    "status": "已支付",
    "createTime": "2025-10-13 14:45:00",
    "payTime": "2025-10-13 14:50:00"
  }
}
```

### 5.4 乘客管理接口

#### 5.4.1 获取乘客列表
- **接口**：`GET /api/passengers`
- **请求头**：`Authorization: Bearer {token}`
- **响应**：
```json
{
  "code": 200,
  "message": "查询成功",
  "data": [
    {
      "passengerId": 1,
      "name": "张三",
      "idType": "居民身份证",
      "idNumber": "110101199001011234",
      "phone": "13800138000",
      "passengerType": "成人",
      "verified": true
    }
  ]
}
```

#### 5.4.2 添加乘客
- **接口**：`POST /api/passengers`
- **请求头**：`Authorization: Bearer {token}`
- **请求参数**：
```json
{
  "name": "李四",
  "idType": "居民身份证",
  "idNumber": "110101200001011234",
  "phone": "13900139000",
  "passengerType": "学生"
}
```
- **响应**：
```json
{
  "code": 200,
  "message": "添加成功",
  "data": {
    "passengerId": 2
  }
}
```

#### 5.4.3 编辑乘客
- **接口**：`PUT /api/passengers/{passengerId}`
- **请求头**：`Authorization: Bearer {token}`
- **请求参数**：同添加乘客
- **响应**：
```json
{
  "code": 200,
  "message": "修改成功"
}
```

#### 5.4.4 删除乘客
- **接口**：`DELETE /api/passengers/{passengerId}`
- **请求头**：`Authorization: Bearer {token}`
- **响应**：
```json
{
  "code": 200,
  "message": "删除成功"
}
```

### 5.5 个人信息接口

#### 5.5.1 获取个人信息
- **接口**：`GET /api/user/profile`
- **请求头**：`Authorization: Bearer {token}`
- **响应**：
```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "userId": 1,
    "username": "zhangsan",
    "realName": "张三",
    "idType": "居民身份证",
    "idNumber": "110101199001011234",
    "phone": "13800138000",
    "email": "zhangsan@example.com",
    "userType": "成人"
  }
}
```

#### 5.5.2 更新个人信息
- **接口**：`PUT /api/user/profile`
- **请求头**：`Authorization: Bearer {token}`
- **请求参数**：
```json
{
  "realName": "张三",
  "phone": "13800138000",
  "email": "zhangsan@example.com"
}
```
- **响应**：
```json
{
  "code": 200,
  "message": "更新成功"
}
```

---

## 六、前端页面路由设计

### 6.1 路由表
| 路由路径 | 页面名称 | 说明 | 访问权限 |
|----------|----------|------|----------|
| `/` | 首页 | 车票查询入口 | 公开 |
| `/login` | 登录页 | 用户登录 | 公开 |
| `/register` | 注册页 | 用户注册 | 公开 |
| `/trains` | 车次列表页 | 显示查询结果 | 公开 |
| `/order/create` | 订单填写页 | 填写订单信息 | 需登录 |
| `/order/:orderId` | 订单详情页 | 查看订单详情 | 需登录 |
| `/user` | 个人中心 | 个人信息、乘客、订单管理 | 需登录 |
| `/user/profile` | 个人信息页 | 查看/编辑个人信息 | 需登录 |
| `/user/passengers` | 乘客管理页 | 管理常用乘客 | 需登录 |
| `/user/orders` | 订单管理页 | 查看订单列表 | 需登录 |

### 6.2 路由守卫
**需登录页面访问控制**：
- 用户未登录访问需登录的页面时，跳转至登录页
- 登录成功后跳转回原页面
- 已登录用户访问登录/注册页自动跳转首页

---

## 七、表单验证规则

### 7.1 注册表单验证
| 字段 | 验证规则 | 错误提示 |
|------|----------|----------|
| 用户名 | 6-30位字符，仅字母数字 | "用户名为6-30位字母或数字" |
| 密码 | 6-20位，包含字母和数字 | "密码需6-20位，且包含字母和数字" |
| 确认密码 | 与密码一致 | "两次密码输入不一致" |
| 真实姓名 | 2-10个中文字符 | "请输入正确的姓名" |
| 身份证号 | 18位，符合身份证规则 | "请输入正确的身份证号码" |
| 手机号 | 11位数字，1开头 | "请输入正确的手机号" |
| 邮箱 | 邮箱格式 | "请输入正确的邮箱地址" |

### 7.2 登录表单验证
| 字段 | 验证规则 | 错误提示 |
|------|----------|----------|
| 用户名 | 非空 | "请输入用户名" |
| 密码 | 非空 | "请输入密码" |
| 验证码 | 非空，4位 | "请输入验证码" |

### 7.3 乘客信息验证
| 字段 | 验证规则 | 错误提示 |
|------|----------|----------|
| 姓名 | 2-10个中文字符 | "请输入正确的姓名" |
| 证件号码 | 根据证件类型验证 | "请输入正确的证件号码" |
| 手机号 | 11位数字 | "请输入正确的手机号" |

---

## 八、错误处理

### 8.1 HTTP状态码
- `200`：请求成功
- `400`：请求参数错误
- `401`：未登录或登录过期
- `403`：无权限访问
- `404`：资源不存在
- `500`：服务器内部错误

### 8.2 业务错误码
| 错误码 | 说明 |
|--------|------|
| 10001 | 用户名已存在 |
| 10002 | 手机号已注册 |
| 10003 | 邮箱已注册 |
| 10004 | 用户名或密码错误 |
| 10005 | 验证码错误 |
| 20001 | 车次不存在 |
| 20002 | 余票不足 |
| 20003 | 座位已被占用 |
| 30001 | 订单不存在 |
| 30002 | 订单状态不允许此操作 |
| 30003 | 订单已超时 |
| 40001 | 乘客不存在 |
| 40002 | 乘客已存在 |
| 40003 | 乘客有未完成订单，无法删除 |

### 8.3 错误提示
**前端错误提示方式**：
- 表单验证错误：字段下方红色文字提示
- 接口错误：顶部Toast提示或弹窗
- 系统错误：友好的错误页面

---

## 九、技术实现建议

### 9.1 前端技术栈

#### 9.1.1 核心框架
- **Vue 3.3+**
  - Composition API
  - `<script setup>` 语法
  - 响应式系统

#### 9.1.2 UI组件库
- **Ant Design Vue 4.x**
  - 丰富的组件库
  - 统一的设计语言
  - 完善的文档

#### 9.1.3 状态管理
- **Pinia 2.x**
  - Vue 3官方推荐
  - 更简洁的API
  - 完整的TypeScript支持

#### 9.1.4 路由管理
- **Vue Router 4.x**
  - 路由守卫
  - 动态路由
  - 路由懒加载

#### 9.1.5 工具库
- **Axios**：HTTP客户端
- **Day.js**：日期处理
- **js-cookie**：Cookie管理
- **@vueuse/core**：Vue组合式工具集

#### 9.1.6 开发工具
- **Vite 5.x**：构建工具
- **ESLint + Prettier**：代码规范
- **TypeScript（可选）**：类型检查

### 9.2 后端技术栈

#### 9.2.1 核心框架
- **Python 3.10+**
- **FastAPI 0.100+**
  - 高性能异步框架
  - 自动生成API文档（Swagger UI）
  - 数据验证（Pydantic）
  - 类型提示支持

#### 9.2.2 数据库相关
- **MySQL 8.0+**：主数据库
- **SQLAlchemy 2.0+**：ORM框架
- **PyMySQL / mysqlclient**：MySQL驱动
- **Alembic**：数据库迁移工具

#### 9.2.3 认证与安全
- **python-jose**：JWT Token生成
- **passlib[bcrypt]**：密码加密
- **python-multipart**：文件上传支持

#### 9.2.4 其他依赖
- **Pydantic**：数据验证
- **uvicorn**：ASGI服务器
- **python-dotenv**：环境变量管理
- **loguru**：日志处理

### 9.3 数据库
- **MySQL 8.0+**
  - InnoDB存储引擎
  - UTF8MB4字符集
  - 事务支持

### 9.3 开发工具
- **版本控制**：Git
- **代码编辑器**：VS Code / IntelliJ IDEA
- **API测试**：Postman
- **数据库管理**：Navicat / MySQL Workbench

---

## 十、测试要点

### 10.1 功能测试
- [ ] 用户注册功能
- [ ] 用户登录功能
- [ ] 车票查询功能
- [ ] 车次筛选功能
- [ ] 创建订单功能
- [ ] 支付订单功能
- [ ] 取消订单功能
- [ ] 退票功能
- [ ] 添加乘客功能
- [ ] 编辑乘客功能
- [ ] 删除乘客功能
- [ ] 修改个人信息功能

### 10.2 边界场景测试
- [ ] 注册时用户名已存在
- [ ] 登录密码错误
- [ ] 查询未来30天后的车票
- [ ] 查询无结果情况
- [ ] 余票不足时预订
- [ ] 订单超时自动取消
- [ ] 删除有订单的乘客
- [ ] 同一证件号重复添加乘客

### 10.3 表单验证测试
- [ ] 各字段格式验证
- [ ] 必填字段验证
- [ ] 特殊字符输入
- [ ] 超长输入
- [ ] SQL注入防护

---

## 十一、数据生成建议

### 11.1 车站数据
生成50-100个常用车站，包括：
- 北京南、北京西、上海虹桥、上海站
- 广州南、深圳北、杭州东、南京南
- 成都东、重庆北、武汉站、西安北
- 等主要城市车站

### 11.2 车次数据
为每对热门城市生成10-20个车次：
- 高铁（G字头）：速度快，票价高
- 动车（D字头）：速度中等，票价适中
- 直达（Z字头）：速度较慢，票价低

### 11.3 座位数据
每个车次每天自动生成座位：
- 一等座：20-50个
- 二等座：80-150个
- 软卧：0-30个
- 硬卧：0-60个

### 11.4 数据生成脚本示例
```sql
-- 插入车站数据
INSERT INTO stations (station_name, city, pinyin, short_pinyin) VALUES
('北京南', '北京', 'beijingnan', 'bjn'),
('上海虹桥', '上海', 'shanghaihongqiao', 'shhq'),
('广州南', '广州', 'guangzhounan', 'gzn');

-- 插入车次数据
INSERT INTO trains (train_number, train_type, departure_station_id, arrival_station_id, 
  departure_time, arrival_time, duration_minutes, 
  first_class_seats, second_class_seats, 
  first_class_price, second_class_price) 
VALUES
('G1', '高铁', 1, 2, '08:00', '13:30', 330, 50, 120, 933.0, 553.0);
```

---

## 十二、项目开发建议

### 12.1 开发阶段划分
**第一阶段（2周）**：
- 数据库设计与创建
- 后端基础框架搭建
- 前端项目初始化
- 用户认证模块（注册、登录）

**第二阶段（2周）**：
- 车票查询功能
- 车次列表展示
- 筛选排序功能

**第三阶段（2周）**：
- 订单创建流程
- 订单支付（简化）
- 订单列表查询
- 订单详情展示

**第四阶段（2周）**：
- 乘客管理功能
- 个人信息管理
- 订单取消退票功能

**第五阶段（1周）**：
- 功能测试
- Bug修复
- 界面优化
- 文档整理

### 12.2 团队分工建议
- **前端开发**：2人（页面开发、组件封装）
- **后端开发**：2人（接口开发、业务逻辑）
- **数据库设计**：1人（可与后端兼任）
- **测试**：全员参与

### 12.3 注意事项
1. 定期代码提交和备份
2. 前后端接口文档及时同步
3. 遇到问题及时沟通
4. 保持代码风格统一
5. 重要功能点做好注释

---

## 附录

### 附录A：12306官网功能对比
本项目实现的是12306的核心功能子集，主要包括：
- ✅ 用户注册登录
- ✅ 车票查询
- ✅ 车次筛选
- ✅ 订单创建
- ✅ 订单支付（简化）
- ✅ 订单管理
- ✅ 乘客管理
- ❌ 候补购票（未实现）
- ❌ 改签功能（未实现）
- ❌ 会员积分（未实现）
- ❌ 餐饮订购（未实现）

### 附录B：项目目录结构建议

**前端项目结构（Vue示例）**：
```
railway-frontend/
├── public/
├── src/
│   ├── assets/          # 静态资源
│   ├── components/      # 公共组件
│   │   ├── Header.vue
│   │   ├── Footer.vue
│   │   └── ...
│   ├── views/           # 页面组件
│   │   ├── Home.vue
│   │   ├── Login.vue
│   │   ├── Register.vue
│   │   ├── TrainList.vue
│   │   ├── OrderCreate.vue
│   │   └── User/
│   │       ├── Profile.vue
│   │       ├── Passengers.vue
│   │       └── Orders.vue
│   ├── router/          # 路由配置
│   ├── store/           # 状态管理
│   ├── api/             # API封装
│   ├── utils/           # 工具函数
│   └── App.vue
├── package.json
└── README.md
```

**后端项目结构（Spring Boot示例）**：
```
railway-backend/
├── src/main/java/com/railway/
│   ├── controller/      # 控制器
│   │   ├── AuthController.java
│   │   ├── TrainController.java
│   │   ├── OrderController.java
│   │   ├── PassengerController.java
│   │   └── UserController.java
│   ├── service/         # 业务逻辑
│   ├── mapper/          # 数据访问
│   ├── entity/          # 实体类
│   ├── dto/             # 数据传输对象
│   ├── config/          # 配置类
│   └── utils/           # 工具类
├── src/main/resources/
│   ├── application.yml
│   └── mapper/          # MyBatis映射文件
└── pom.xml
```

---

**文档结束**

此需求文档聚焦于课程项目的核心功能，提供了清晰的界面需求、功能模块、数据库设计和API接口定义。建议按照分阶段开发计划逐步实现各项功能。
